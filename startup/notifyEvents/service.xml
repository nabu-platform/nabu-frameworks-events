<sequence xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
		disabled="false"
		id="3b1e9f1d-e441-47a9-9995-009fee787ecb">
	<steps xsi:type="be.nabu.libs.services.vm.step.Map"
			disabled="false"
			id="268daf4c7a944b108c6c56f7ed730314">
		<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
				disabled="false"
				id="5bfc19ae-949a-4fac-b190-f55313855cf6"
				serviceId="nabu.frameworks.events.utils.isSynchronized"
				resultName="resultcf39271006164149a567ffed242aea9f"
				temporaryMapping="true"
				x="86"
				y="72"
				invocationOrder="0"
				asynchronous="false"
				recache="false">
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="6f7b50ee-1b83-4645-89a3-713498493d4c"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultcf39271006164149a567ffed242aea9f/synchronized</from>
			<to>synchronized</to>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.Link"
				disabled="false"
				id="ce733c58-a438-4fde-a546-d5b9b86e52c0"
				mask="false"
				optional="false"
				fixedValue="false">
			<from>resultcf39271006164149a567ffed242aea9f/jdbcId</from>
			<to>jdbcId</to>
		</steps>
	</steps>
	<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
			disabled="false"
			id="7846c404-e249-488b-a060-86e3ce93c4a5"
			query="synchronized">
		<steps xsi:type="be.nabu.libs.services.vm.step.Map"
				disabled="false"
				id="737283c9-12bf-4c11-8c76-8501e3a6cb3f"
				label="false">
			<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
					disabled="false"
					id="d73dc183-62b5-4308-acfb-af83e1ab023a"
					serviceId="nabu.utils.Server.log"
					resultName="resultc66d3c873cdf46318bc7e253d6a7c1ea"
					temporaryMapping="true"
					x="51"
					y="71"
					invocationOrder="0"
					asynchronous="false"
					recache="false">
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="166a01fa-d2b5-4f0d-8855-0f6de313d1ae"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>Either the jdbc pool for events is not configured, or the tables are not synchronized. Disabling event notification.</from>
					<to>message</to>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Link"
						disabled="false"
						id="29669dbe-8eb3-43ba-8fa1-d2ebe2c74def"
						mask="false"
						optional="false"
						fixedValue="true">
					<from>WARN</from>
					<to>level</to>
				</steps>
			</steps>
		</steps>
		<steps xsi:type="be.nabu.libs.services.vm.step.For"
				disabled="false"
				id="91eec265-176d-449d-a9c6-bb3e1040a35a">
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					disabled="false"
					id="e7e26569-e77e-4fe0-bb37-017fbafc8421">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="We want best effort locking, don't block if you can't, someone else is dealing with it"
						disabled="false"
						id="99097320-ab4f-40a6-839d-c877b51c52ad">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="f9554ae1-f430-4101-8138-af0a1975b403"
							serviceId="nabu.utils.Lock.tryLock"
							resultName="result248f7e42fd7b46c99b8e3c59a94c9172"
							temporaryMapping="true"
							x="36"
							y="56"
							invocationOrder="0"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="d961a5eb-2866-4678-be54-e968c01a748d"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>notify-events</from>
							<to>name</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="873aa6b4-7fa5-4a9a-84b4-5eaac1f63d0e"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>false</from>
							<to>local</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Link"
							disabled="false"
							id="23f1abb4-ac15-4e0e-9eed-ba5d4c617554"
							mask="false"
							optional="false"
							fixedValue="false">
						<from>result248f7e42fd7b46c99b8e3c59a94c9172/locked</from>
						<to>locked</to>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
						comment="Only continue if we have the lock"
						disabled="false"
						id="0f419766-a009-4da3-b094-03df76c0303d"
						label="locked"
						transactionVariable="transactionId">
					<steps xsi:type="be.nabu.libs.services.vm.step.Map"
							comment="Get unnotified events in batches of 1000"
							disabled="false"
							id="ba81a368-9ec5-4acb-ad82-4493c73d3d81">
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="3c71391e-031c-4201-b20c-e281b553477a"
								serviceId="nabu.frameworks.events.utils.event.getUnnotified"
								resultName="result7ecbefd3a72e4cc6be05fd43ad2a2982"
								temporaryMapping="true"
								x="84"
								y="63"
								invocationOrder="0"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="70745dc5-7c05-4396-8b7b-9f27ef990480"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>created desc</from>
								<to>orderBy[0]</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="b91e0b36-051e-4e19-a25e-12db90da29b5"
									mask="false"
									optional="false"
									fixedValue="true">
								<from>1000</from>
								<to>limit</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="6a3187c6-765e-4d23-9346-48a8d6a9f153"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>transactionId</from>
								<to>transaction</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="370bcb84-1902-47d0-9ab5-122116a340ee"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>jdbcId</from>
								<to>connection</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="59bff848-fbb9-48fa-af3e-7962f8b1752b"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result7ecbefd3a72e4cc6be05fd43ad2a2982/results</from>
							<to>events</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
								disabled="false"
								id="76522a67-695e-4b5f-91ce-ff2eca1d6684"
								serviceId="nabu.utils.List.size"
								resultName="result1061b113e44f421693f2765eb7a0fa76"
								temporaryMapping="true"
								x="230"
								y="256"
								invocationOrder="1"
								asynchronous="false"
								recache="false">
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="75b89f6f-c9c9-4ae8-81d5-7017b3b854fb"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result7ecbefd3a72e4cc6be05fd43ad2a2982/results</from>
								<to>list</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="4127a110-6082-4f0d-a010-9513d1bb4dfd"
								mask="false"
								optional="false"
								fixedValue="false">
							<from>result1061b113e44f421693f2765eb7a0fa76/size</from>
							<to>totalRowCount</to>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
							disabled="false"
							id="c506cacf-69e5-4655-a5ed-fafc372c9d3e"
							label="events">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Group events by their rule"
								disabled="false"
								id="b3f060e3-4106-4994-a30e-51deb91f80c0">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="bc85fdd3-8db4-47ab-8777-7d8823831769"
									serviceId="nabu.utils.List.group"
									resultName="resultff1354b2427446d3864c400fefa82763"
									temporaryMapping="true"
									x="32"
									y="80"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="71761710-4d66-4bae-9f1c-c4ea38c8f37e"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>events</from>
									<to>list</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="5aa724b1-278d-4858-8575-70496bc3182f"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>nabu.frameworks.events.utils.groupedEvent</from>
									<to>definition</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="5fee7e2c-9fa0-4078-b76e-192288b94617"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resultff1354b2427446d3864c400fefa82763/response</from>
								<to>groupedEvents</to>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="4d299d8b-a582-49cc-af10-ae5825e9ae3a"
									serviceId="nabu.utils.Date.now"
									resultName="result79a81f91c39a46868871d8a08fd56b08"
									temporaryMapping="true"
									x="234"
									y="223"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="f86c5139-fe46-4864-b30f-c24e25fbdf58"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>result79a81f91c39a46868871d8a08fd56b08/date</from>
								<to>now</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Get unique rule ids (their might be none!)"
								disabled="false"
								id="02ab7dbd-2b7f-4d79-9e47-991e694eb174">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="43a393c1-4afb-43fc-af7e-2d8e1148d9e7"
									serviceId="nabu.utils.List.unique"
									resultName="resultfad1d8fc044e4f3e975a710d11c0650b"
									temporaryMapping="true"
									x="95"
									y="87"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="75f41a5e-8b14-4a43-8a7d-8a86ed857eaf"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>groupedEvents/eventRuleId</from>
									<to>list</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Link"
									disabled="false"
									id="93fd6b49-cbff-43e1-a62f-7ea5fcdb553f"
									mask="false"
									optional="false"
									fixedValue="false">
								<from>resultfad1d8fc044e4f3e975a710d11c0650b/list</from>
								<to>uniqueEventRuleIds</to>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
								comment="We can only have notification rules if we have any rule ids"
								disabled="false"
								id="0e8f7cf9-7502-420f-beda-d97d81b3ae3b"
								label="uniqueEventRuleIds != null">
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Select notifications for all triggered rules"
									disabled="false"
									id="78a8a5d4-207e-4409-b48d-81da0a798b29">
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="63ccaf91-3fea-421d-a095-8d99bfa61026"
										serviceId="nabu.frameworks.events.utils.notification.getNotificationsForRule"
										resultName="result6939344dd90a4c648a4241bb9acfe88e"
										temporaryMapping="true"
										x="96"
										y="130"
										invocationOrder="1"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="942ff783-4cf5-46d8-8500-43221aab2f30"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>resultbdbeeb5cfb5f4c688debc638a3c45266/list</from>
										<to>parameters/eventRuleId</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="774b2d21-2383-4a63-91a8-6f962f078fd2"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>jdbcId</from>
										<to>connection</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="e05a9236-938b-4f3e-b255-fc366a939aae"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>transactionId</from>
										<to>transaction</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="04a24836-837f-422a-bb1b-47564126358f"
										serviceId="nabu.utils.List.unique"
										resultName="resultbdbeeb5cfb5f4c688debc638a3c45266"
										temporaryMapping="true"
										x="21"
										y="39"
										invocationOrder="0"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="6b7b9c83-cb8d-40a3-bade-4e850ca96483"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>groupedEvents/eventRuleId</from>
										<to>list</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="f5fabb5f-2d60-46b3-a909-7868ebc35fca"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>result6939344dd90a4c648a4241bb9acfe88e/results</from>
									<to>notifications</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Group notifications"
									disabled="false"
									id="b40f3322-3f59-482a-aba0-11201e7660df">
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="234bfd52-ed30-437e-9725-be823d29a510"
										serviceId="nabu.utils.List.group"
										resultName="resultd5cdbc0619bb47d48443e0f10fe7213e"
										temporaryMapping="true"
										x="221"
										y="81"
										invocationOrder="0"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="2e964fee-454f-47d1-9018-89cfb4cab26e"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>notifications</from>
										<to>list</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="0f00d09d-13e4-480c-9328-0f702865ad7b"
											mask="false"
											optional="false"
											fixedValue="true">
										<from>nabu.frameworks.events.utils.groupedNotification</from>
										<to>definition</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="433dc162-0fe5-4372-a14a-15e2e98f986c"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>resultd5cdbc0619bb47d48443e0f10fe7213e/response</from>
									<to>groupedNotifications</to>
								</steps>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.For"
									comment="We need to work based on the notifications"
									disabled="false"
									id="01134c80-8896-4f44-af3d-ebf3cdc691a0"
									variable="groupedNotification">
								<steps xsi:type="be.nabu.libs.services.vm.step.Map"
										comment="Get all applicable event rules"
										disabled="false"
										id="ccb1eb88-8edc-4b87-b194-2f713a7f1fb0">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="1bad6db3-59d9-45b6-a4ab-6105e8e20b83"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>groupedNotification/notifications/eventRuleId</from>
										<to>applicatableEventRuleIds</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Map"
										comment="Get all applicable events for those rules"
										disabled="false"
										id="057b8bde-4487-49eb-b5de-694e50424c14">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="f7251f27-97bd-4901-b74d-353f1f147eda"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>groupedEvents[eventRuleId # /applicatableEventRuleIds]</from>
										<to>applicableEvents</to>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Switch"
										disabled="false"
										id="3a48d48c-c8e1-4bce-a634-860d4904a728"
										query="groupedNotification/notificationInterval">
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="All notifications should be triggered"
											disabled="false"
											id="68330631-27c8-4a4d-848b-5f0be3cfd6d9"
											label="null">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="9d7c63aa-a595-4ed4-8904-924b448c3ae9"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>groupedNotification/notifications</from>
											<to>applicableNotifications</to>
										</steps>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
											comment="Only the subscribers that have not been notified in a while should be triggered"
											disabled="false"
											id="ac208b02-9c48-4034-abce-80e88e5ee2e4">
										<steps xsi:type="be.nabu.libs.services.vm.step.Map"
												comment="Get the past"
												disabled="false"
												id="cffff6a2-952a-44ed-8bf6-2d9b1d503203">
											<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
													disabled="false"
													id="e2da3026-e380-48ed-834b-11bffb4f91fb"
													serviceId="nabu.utils.Date.incrementDuration"
													resultName="result322e31d4b2b54dcea018d28375f5a440"
													temporaryMapping="true"
													x="63"
													y="125"
													invocationOrder="0"
													asynchronous="false"
													recache="false">
												<steps xsi:type="be.nabu.libs.services.vm.step.Link"
														disabled="false"
														id="b2cb7fa3-6aa6-49c9-a1ca-cfcd3ecd8fc5"
														mask="false"
														optional="false"
														fixedValue="false">
													<from>groupedNotification/notificationInterval</from>
													<to>duration</to>
												</steps>
												<steps xsi:type="be.nabu.libs.services.vm.step.Link"
														disabled="false"
														id="d58bfc84-c163-4c7a-a890-e84ad8be51c8"
														mask="false"
														optional="false"
														fixedValue="true">
													<from>-1</from>
													<to>times</to>
												</steps>
												<steps xsi:type="be.nabu.libs.services.vm.step.Link"
														disabled="false"
														id="aee18cfb-60b9-4f2e-bebb-eeca13f2eaff"
														mask="false"
														optional="false"
														fixedValue="true">
													<from>UTC</from>
													<to>timezone</to>
												</steps>
											</steps>
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="3d306cce-f276-4996-bd78-31119e8463d7"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>result322e31d4b2b54dcea018d28375f5a440/date</from>
												<to>lastNotifiedBefore</to>
											</steps>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Map"
												comment="Map subscribers that are relevant"
												disabled="false"
												id="aa06f60a-602a-4eb3-bfba-8ffdfa8e36d7">
											<steps xsi:type="be.nabu.libs.services.vm.step.Link"
													disabled="false"
													id="16f7cef0-b6b4-44dd-bf08-158ff12d9070"
													mask="false"
													optional="false"
													fixedValue="false">
												<from>groupedNotification/notifications[lastNotified = null || lastNotified &gt; /lastNotifiedBefore]</from>
												<to>applicableNotifications</to>
											</steps>
										</steps>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.For"
										comment="Combine all subscribers"
										disabled="false"
										id="1b0520d9-6044-4e9d-b35b-5ef86bb5670f"
										variable="applicableNotificationList"
										into="allSubscribers">
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="Map subscriber"
											disabled="false"
											id="f1c0a38a-5ebd-46c3-8277-ff5123856aae">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="8ba0a8d7-6da7-4f05-bb83-cb4592337bf3"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>applicableNotificationList/lastNotified</from>
											<to>allSubscribers[0]/lastNotified</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="6d37340e-d39e-47b7-b539-2b55ee12f997"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>applicableNotificationList/subscriberId</from>
											<to>allSubscribers[0]/subscriberId</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="6a7818a8-0bda-448e-8f19-3e6ef97fa214"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>applicableNotificationList/eventSubscriberId</from>
											<to>allSubscribers[0]/id</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="c45fe489-8664-4f04-b599-ec751478642f"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>applicableNotificationList/notificationId</from>
											<to>allSubscribers[0]/eventNotificationId</to>
										</steps>
									</steps>
									<query>groupedNotification/notifications</query>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Map"
										comment="Call the notify service"
										disabled="false"
										id="a6ec51cd-3293-4dbd-ba5e-bf5a8ba9ea7e">
									<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
											disabled="false"
											id="e2b1433d-493d-44a4-b609-0587764d32f9"
											serviceId="nabu.frameworks.events.specs.notify"
											resultName="result01ed09ecca3f4f56bde78f005729470f"
											temporaryMapping="true"
											x="213"
											y="59"
											invocationOrder="0"
											asynchronous="false"
											recache="false">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="025c179f-a1b6-4ec2-b468-b28a4d001c24"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>groupedNotification/service</from>
											<to>implementationId</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="53a112f0-1112-4333-bb7e-d0eae608417d"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>allSubscribers</from>
											<to>subscribers</to>
										</steps>
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="35b0344c-e606-45df-93c4-efe3e3c3a65f"
												mask="false"
												optional="false"
												fixedValue="true">
											<from>true</from>
											<to>useAsContext</to>
										</steps>
									</steps>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.For"
										comment="Set the last notified on the subscriber"
										disabled="false"
										id="836c3a00-0a8f-4146-b22d-bf8d139e8ff1"
										variable="singleSubscriber">
									<steps xsi:type="be.nabu.libs.services.vm.step.Map"
											comment="Map now"
											disabled="false"
											id="de22b128-ceec-4855-a91d-eba2771c0706">
										<steps xsi:type="be.nabu.libs.services.vm.step.Link"
												disabled="false"
												id="19d55e95-7e8d-4838-bd80-e762e259346e"
												mask="false"
												optional="false"
												fixedValue="false">
											<from>now</from>
											<to>singleSubscriber/lastNotified</to>
										</steps>
									</steps>
									<query>allSubscribers</query>
								</steps>
								<query>groupedNotifications</query>
							</steps>
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Update subscribers"
									disabled="false"
									id="a086b8e7-feb8-4b09-8d29-2ba481e1412f"
									label="allSubscribers">
								<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
										disabled="false"
										id="03d482ce-7e53-4460-8203-e9bd61b86797"
										serviceId="nabu.services.jdbc.Services.update"
										resultName="result46d4f3e0fb8b495da91d59b39d3074d9"
										temporaryMapping="true"
										x="114"
										y="167"
										invocationOrder="0"
										asynchronous="false"
										recache="false">
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="7f0b943e-0c50-4a1c-b661-a82c4dec28f1"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>allSubscribers</from>
										<to>instances</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="618f1107-ea3d-4cb3-af44-1b33cb47ccd6"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>transactionId</from>
										<to>transaction</to>
									</steps>
									<steps xsi:type="be.nabu.libs.services.vm.step.Link"
											disabled="false"
											id="69304e4a-3974-47b3-86df-d24bdb0f8fce"
											mask="false"
											optional="false"
											fixedValue="false">
										<from>jdbcId</from>
										<to>connection</to>
									</steps>
								</steps>
							</steps>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.For"
								comment="Set the notified on the event"
								disabled="false"
								id="9d8666dd-bba7-45dc-bf1a-5757fc96e65f"
								variable="singleEvent">
							<steps xsi:type="be.nabu.libs.services.vm.step.Map"
									comment="Map now"
									disabled="false"
									id="d4945633-18d2-4a17-847d-483d44818fad">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="47221181-23c7-412d-91d9-7de25a30da5b"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>now</from>
									<to>singleEvent/notified</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="5cf95487-fde0-4603-adf3-c0a5725f063a"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>NOTIFIED</from>
									<to>singleEvent/state</to>
								</steps>
							</steps>
							<query>events</query>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								comment="Update all events"
								disabled="false"
								id="c4d15d27-8db0-42d0-99f0-3a91308528af">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="f355bb92-911d-4700-bf3d-50b7b0f4a362"
									serviceId="nabu.services.jdbc.Services.update"
									resultName="result3b0841a5c8c943ebbf5235d2d9e6eb0f"
									temporaryMapping="true"
									x="159"
									y="56"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="10db5383-fe3d-46c0-bd95-0fc8dff411a9"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>transactionId</from>
									<to>transaction</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="3420763d-5b57-462a-a3ea-6891500e651f"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>jdbcId</from>
									<to>connection</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="63d089a9-f6b5-480c-832e-cdcaaf77b820"
										mask="false"
										optional="false"
										fixedValue="false">
									<from>events</from>
									<to>instances</to>
								</steps>
							</steps>
						</steps>
					</steps>
					<steps xsi:type="be.nabu.libs.services.vm.step.Finally"
							disabled="false"
							id="9bbb3462-02f3-4503-b666-3c8f73e40dd2">
						<steps xsi:type="be.nabu.libs.services.vm.step.Map"
								disabled="false"
								id="8e0ee8ce-25a8-4c54-9250-29b9954d0a79">
							<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
									disabled="false"
									id="c5ba326d-e50b-48c3-8edc-b2f7c5c812a9"
									serviceId="nabu.utils.Lock.unlock"
									resultName="result5560234793f74e52b43ca55ead9ea137"
									temporaryMapping="true"
									x="84"
									y="143"
									invocationOrder="0"
									asynchronous="false"
									recache="false">
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="845dc104-dc7e-4fbd-98c7-244942bb2535"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>notify-events</from>
									<to>name</to>
								</steps>
								<steps xsi:type="be.nabu.libs.services.vm.step.Link"
										disabled="false"
										id="789333ad-9515-4283-86c3-6fe0a2a2347d"
										mask="false"
										optional="false"
										fixedValue="true">
									<from>false</from>
									<to>local</to>
								</steps>
							</steps>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
						comment="We need to move on!"
						disabled="false"
						id="208940d4-b3ed-4c24-a5e7-5b17c2c05c16">
				</steps>
			</steps>
			<steps xsi:type="be.nabu.libs.services.vm.step.Sequence"
					comment="We only sleep if we did not process anything or we didn't hit our processing limit"
					disabled="false"
					id="669e8091-9994-4873-bcf9-d885c326df21"
					label="totalRowCount = null || totalRowCount &lt; 1000">
				<steps xsi:type="be.nabu.libs.services.vm.step.Map"
						comment="Sleep for a while. The server who previously had the lock takes a certain amount of time to notify, introducing random server selection"
						disabled="false"
						id="0e4030f2-e5a5-45b1-919f-116be753b737">
					<steps xsi:type="be.nabu.libs.services.vm.step.Invoke"
							disabled="false"
							id="808f3358-1b26-459f-a34e-efc71393b5cf"
							serviceId="nabu.utils.Server.sleep"
							resultName="result5be0f7ac19604f488cb8d69cc086145a"
							temporaryMapping="true"
							x="21"
							y="24"
							invocationOrder="1"
							asynchronous="false"
							recache="false">
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="ad1da4c6-3565-471f-a839-fafaf500fb54"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>SECONDS</from>
							<to>unit</to>
						</steps>
						<steps xsi:type="be.nabu.libs.services.vm.step.Link"
								disabled="false"
								id="caf90a9e-2e99-4420-ba67-2c4c744497b4"
								mask="false"
								optional="false"
								fixedValue="true">
							<from>5</from>
							<to>amount</to>
						</steps>
					</steps>
				</steps>
				<steps xsi:type="be.nabu.libs.services.vm.step.Catch"
						comment="No sleep for the wicked!"
						disabled="false"
						id="4df4d8bb-568f-4a64-8533-f9a88ea09e23">
				</steps>
			</steps>
			<query>true</query>
		</steps>
	</steps>
</sequence>